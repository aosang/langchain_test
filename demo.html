<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIåŠ©æ‰‹èŠå¤©</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- Markdownæ¸²æŸ“åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
  <!-- ä»£ç é«˜äº®åº“ -->
  <script src="https://unpkg.com/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <!-- Prism CSS -->
  <link rel="stylesheet" href="https://unpkg.com/prismjs@1.29.0/themes/prism.min.css">
  <!-- favicon -->
  <link rel="icon" href="./miles.ico">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: #f5f5f5;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .chat-container {
      width: 90%;
      max-width: 900px;
      height: 700px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1rem;
      text-align: center;
    }

    .header h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .status {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .message {
      margin-bottom: 1rem;
      display: flex;
      animation: fadeIn 0.3s ease-in;
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.ai {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 80%;
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      position: relative;
    }

    .message.user .message-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom-right-radius: 0.25rem;
    }

    .message.ai .message-content {
      background: #f3f4f6;
      color: #374151;
      border-bottom-left-radius: 0.25rem;
    }

     .message-text {
       line-height: 1.3 !important;
       white-space: normal !important;
     }

    .message-time {
      font-size: 0.75rem;
      opacity: 0.7;
      margin-top: 0.25rem;
      text-align: right;
    }

    .thinking {
      opacity: 0.8;
      font-style: italic;
    }

    .input-area {
      border-top: 1px solid #e5e7eb;
      padding: 1rem;
    }

    .input-container {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .input-container input {
      flex: 1;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      font-family: inherit;
      font-size: 0.9rem;
      transition: border-color 0.2s;
    }

    .input-container input:focus {
      outline: none;
      border-color: #667eea;
    }

    .send-button {
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 500;
      transition: opacity 0.2s;
    }

    .send-button:hover:not(:disabled) {
      opacity: 0.9;
    }

    .send-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }


    .clear-button {
      padding: 0.75rem 1rem;
      background: #f3f4f6;
      color: #6b7280;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .clear-button:hover:not(:disabled) {
      background: #e5e7eb;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .loading {
      display: none;
      align-items: center;
      gap: 0.5rem;
      color: #6b7280;
      font-style: italic;
    }

    .loading.show {
      display: flex;
    }

    .dots {
      display: inline-block;
    }

    .dots span {
      display: inline-block;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #9ca3af;
      margin: 0 1px;
      animation: thinking 1.4s infinite ease-in-out both;
    }

    .dots span:nth-child(1) {
      animation-delay: -0.32s;
    }

    .dots span:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes thinking {

      0%,
      80%,
      100% {
        transform: scale(0);
      }

      40% {
        transform: scale(1);
      }
    }

     /* è¶…ç´§å‡‘çš„Markdownæ ·å¼ - å¼ºåˆ¶åº”ç”¨ */
     .message-content h1,
     .message-content h2,
     .message-content h3,
     .message-content h4,
     .message-content h5,
     .message-content h6 {
       margin: 0.3rem 0 0.1rem 0 !important;
       font-weight: 600;
       line-height: 1.1 !important;
     }

     .message-content h1 { 
       font-size: 1.2rem !important; 
       color: #1f2937;
       border-bottom: 1px solid #e5e7eb;
       padding-bottom: 0.1rem !important;
       margin: 0.2rem 0 0.05rem 0 !important;
     }
     
     .message-content h2 { 
       font-size: 1.1rem !important; 
       color: #374151;
       border-bottom: 1px solid #f3f4f6;
       padding-bottom: 0.1rem !important;
       margin: 0.2rem 0 0.05rem 0 !important;
     }
     
     .message-content h3 { 
       font-size: 1.05rem !important; 
       color: #4b5563;
       margin: 0.15rem 0 0.05rem 0 !important;
     }

     .message-content p {
       margin: 0.1rem 0 !important;
       line-height: 1.3 !important;
       color: #374151;
     }

     /* è¶…ç´§å‡‘çš„æ®µè½é—´è· */
     .message-content p + p {
       margin-top: 0.15rem !important;
     }

     /* æ ‡é¢˜åçš„æ®µè½é—´è·æå° */
     .message-content h1 + p,
     .message-content h2 + p,
     .message-content h3 + p,
     .message-content h4 + p,
     .message-content h5 + p,
     .message-content h6 + p {
       margin-top: 0.05rem !important;
     }

     /* æ ‡é¢˜å‰çš„é—´è·æ§åˆ¶ */
     .message-content h1:not(:first-child),
     .message-content h2:not(:first-child),
     .message-content h3:not(:first-child) {
       margin-top: 0.6rem;
     }

     .message-content ul,
     .message-content ol {
       margin: 0.1rem 0 !important;
       padding-left: 1rem;
     }

     .message-content li {
       margin: 0.02rem 0 !important;
       line-height: 1.3 !important;
     }

     /* åˆ—è¡¨é¡¹å†…çš„æ®µè½æ ·å¼ */
     .message-content li p {
       margin: 0.1rem 0;
     }

     /* æ ‡é¢˜åçš„åˆ—è¡¨é—´è·æ›´å° */
     .message-content h1 + ul,
     .message-content h2 + ul,
     .message-content h3 + ul,
     .message-content h1 + ol,
     .message-content h2 + ol,
     .message-content h3 + ol {
       margin-top: 0.1rem;
     }

     .message-content blockquote {
       border-left: 4px solid #667eea;
       margin: 0.6rem 0;
       padding: 0.4rem 0.8rem;
       background: rgba(102, 126, 234, 0.05);
       font-style: italic;
       color: #4b5563;
     }

     .message-content code {
       background: #f1f5f9;
       color: #dc2626;
       padding: 0.15rem 0.3rem;
       border-radius: 0.25rem;
       font-family: 'Courier New', Consolas, monospace;
       font-size: 0.9em;
       border: 1px solid #e2e8f0;
     }

     .message-content pre {
       background: #f8fafc;
       border: 1px solid #e2e8f0;
       border-radius: 0.5rem;
       padding: 0.8rem;
       margin: 0.6rem 0;
       overflow-x: auto;
       font-family: 'Courier New', Consolas, monospace;
       font-size: 0.85em;
       line-height: 1.4;
     }

     .message-content pre code {
       background: none;
       color: #374151;
       padding: 0;
       border-radius: 0;
       border: none;
     }

     .message-content table {
       border-collapse: collapse;
       width: 100%;
       margin: 0.6rem 0;
       font-size: 0.9em;
       border: 1px solid #e5e7eb;
       border-radius: 0.5rem;
       overflow: hidden;
     }

     .message-content th,
     .message-content td {
       border: 1px solid #e5e7eb;
       padding: 0.4rem 0.6rem;
       text-align: left;
     }

     .message-content th {
       background: #f9fafb;
       font-weight: 600;
       color: #374151;
     }

     .message-content tbody tr:nth-child(even) {
       background: #f9fafb;
     }

     .message-content strong {
       font-weight: 600;
       color: #1f2937;
     }

     .message-content em {
       font-style: italic;
       color: #6b7280;
     }

     .message-content a {
       color: #667eea;
       text-decoration: none;
       border-bottom: 1px solid transparent;
       transition: border-color 0.2s;
     }

     .message-content a:hover {
       border-bottom-color: #667eea;
     }

     .message-content hr {
       border: none;
       border-top: 1px solid #e5e7eb;
       margin: 1rem 0;
     }

     /* ç§»é™¤ä¸å¿…è¦çš„ç©ºç™½ */
     .message-content > *:first-child {
       margin-top: 0;
     }

     .message-content > *:last-child {
       margin-bottom: 0;
     }

     /* ä¼˜åŒ–AIæ¶ˆæ¯çš„æ•´ä½“é—´è· */
     .message.ai .message-content {
       line-height: 1.3 !important;
       padding: 0.5rem 0.8rem !important;
     }

     /* å…¨å±€å¼ºåˆ¶ç´§å‡‘æ ·å¼ */
     .message-content * {
       line-height: 1.3 !important;
     }

     /* å¼ºåˆ¶ç§»é™¤æ‰€æœ‰é¦–å°¾å¤šä½™é—´è· */
     .message-content > h1:first-child,
     .message-content > h2:first-child,
     .message-content > h3:first-child,
     .message-content > p:first-child,
     .message-content > ul:first-child,
     .message-content > ol:first-child {
       margin-top: 0 !important;
     }

     .message-content > h1:last-child,
     .message-content > h2:last-child, 
     .message-content > h3:last-child,
     .message-content > p:last-child,
     .message-content > ul:last-child,
     .message-content > ol:last-child {
       margin-bottom: 0 !important;
     }
  </style>
</head>

<body>
  <div class="chat-container">
    <div class="header">
      <h1>ğŸ¤– AIåŠ©æ‰‹èŠå¤©</h1>
      <div class="status" id="status">æ£€æŸ¥è¿æ¥ä¸­...</div>
    </div>

    <div class="messages" id="messages">
      <!-- æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>

    <div class="loading" id="loading">
      <div class="dots">
        <span></span><span></span><span></span>
      </div>
      <span id="loadingText">æ­£åœ¨æ€è€ƒ...</span>
    </div>

    <div class="input-area">
      <div class="input-container">
        <input type="text" id="messageInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜... (Enterå‘é€)" maxlength="1000">
        <button id="sendButton" class="send-button">å‘é€</button>
        <button id="clearButton" class="clear-button">æ¸…ç©ºå¯¹è¯</button>
      </div>
    </div>
  </div>

  <script>
    // é…ç½®
    const API_BASE_URL = 'http://localhost:3001/api';
    const THREAD_ID = 'html-demo-' + Date.now();

    // é…ç½®marked
    console.log('æ£€æŸ¥markedåº“:', typeof marked);
    if (typeof marked !== 'undefined') {
      console.log('markedåº“å·²åŠ è½½ï¼Œç‰ˆæœ¬:', marked.version || 'æœªçŸ¥');
      console.log('markedå¯¹è±¡:', marked);
      
      // æ–°ç‰ˆæœ¬markedé…ç½®æ–¹å¼
      if (marked.setOptions) {
        marked.setOptions({
          breaks: true,
          gfm: true,
          sanitize: false,
          highlight: function(code, lang) {
            if (typeof Prism !== 'undefined' && lang && Prism.languages[lang]) {
              return Prism.highlight(code, Prism.languages[lang], lang);
            }
            return code;
          }
        });
      }
    } else {
      console.error('markedåº“æœªåŠ è½½ï¼');
    }

    // DOMå…ƒç´ 
    const messagesContainer = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const clearButton = document.getElementById('clearButton');
    const statusElement = document.getElementById('status');
    const loadingElement = document.getElementById('loading');
    const loadingText = document.getElementById('loadingText');

    // çŠ¶æ€
    let isLoading = false;
    let currentTypewriterTimeout = null;

    // æ£€æŸ¥è¿æ¥çŠ¶æ€
    async function checkConnection() {
      try {
        await axios.get(`${API_BASE_URL}/health`);
        statusElement.textContent = 'æœåŠ¡è¿æ¥æ­£å¸¸';
        statusElement.style.color = '#4ade80';
        return true;
      }
      catch (error) {
        statusElement.textContent = 'æœåŠ¡è¿æ¥æ–­å¼€';
        statusElement.style.color = '#f87171';
        console.error('æœåŠ¡è¿æ¥å¤±è´¥:', error);
        return false;
      }
    }


     // ç®€å•çš„Markdownæ¸²æŸ“å™¨ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
     function simpleMarkdownRender(content) {
      
      return content
        // æ ‡é¢˜
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        
        // ç²—ä½“
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        
        // æ–œä½“
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        
        // åˆ—è¡¨
        .replace(/^\* (.*$)/gim, '<li>$1</li>')
        .replace(/^- (.*$)/gim, '<li>$1</li>')
        
        // ä»£ç å—
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        .replace(/`(.*?)`/g, '<code>$1</code>')
        
        // æ¢è¡Œ
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>')
        
        // åŒ…è£…æ®µè½
        .replace(/^(.+)$/gim, function(match) {
          if (match.startsWith('<h') || match.startsWith('<li') || match.startsWith('<pre')) {
            return match;
          }
          return '<p>' + match + '</p>';
        })
        
        // æ¸…ç†å¤šä½™çš„æ®µè½æ ‡ç­¾
        .replace(/<p><\/p>/g, '')
        .replace(/<p>(<h[1-6]>.*?<\/h[1-6]>)<\/p>/g, '$1')
        .replace(/<p>(<li>.*?<\/li>)<\/p>/g, '$1')
        .replace(/<p>(<pre>.*?<\/pre>)<\/p>/g, '$1');
    }

     // æ¸²æŸ“markdownå†…å®¹
     function renderMarkdown(content) {
      
      if (typeof marked !== 'undefined') {
        try {
          let rendered;
          
          // å°è¯•ä¸åŒçš„marked APIè°ƒç”¨æ–¹å¼
          if (typeof marked.parse === 'function') {
            rendered = marked.parse(content);
          } else if (typeof marked === 'function') {
            rendered = marked(content);
          } else {
            throw new Error('æ— æ³•æ‰¾åˆ°markedè§£æå‡½æ•°');
          }
          
          return rendered;
        } catch (error) {
          console.error('Markdownæ¸²æŸ“å¤±è´¥:', error);
          return content.replace(/\n/g, '<br>');
        }
      }
       // å¦‚æœæ²¡æœ‰markedåº“ï¼Œä½¿ç”¨ç®€å•çš„Markdownå¤„ç†
      return simpleMarkdownRender(content);
    }

    // æ‰“å­—æœºæ•ˆæœå‡½æ•°
    function typewriterEffect(element, finalContent, isMarkdown = false) {
      return new Promise((resolve) => {
        // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
        if (currentTypewriterTimeout) {
          clearTimeout(currentTypewriterTimeout);
        }

        const speed = 30; // é»˜è®¤æ­£å¸¸é€Ÿåº¦
        let currentText = '';
        let index = 0;

        function typeNextChar() {
          if (index < finalContent.length) {
            currentText += finalContent[index];
            
            // æ›´æ–°æ˜¾ç¤ºå†…å®¹ - æ‰“å­—è¿‡ç¨‹ä¸­åªæ˜¾ç¤ºçº¯æ–‡æœ¬ï¼Œé¿å…ä¸å®Œæ•´Markdownè¯­æ³•
            element.innerHTML = currentText.replace(/\n/g, '<br>');
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            index++;
            currentTypewriterTimeout = setTimeout(typeNextChar, speed);
          } else {
            // å®Œæˆæ‰“å­—æ•ˆæœåï¼Œå¦‚æœéœ€è¦æ¸²æŸ“Markdownï¼Œåˆ™è¿›è¡Œæœ€ç»ˆæ¸²æŸ“
            if (isMarkdown) {
              element.innerHTML = renderMarkdown(finalContent);
              // é‡æ–°è¿è¡Œä»£ç é«˜äº®
              if (typeof Prism !== 'undefined') {
                Prism.highlightAllUnder(element.closest('.message'));
              }
            }
            resolve();
          }
        }

        typeNextChar();
      });
    }

    // æ·»åŠ æ¶ˆæ¯
    function addMessage(type, content, timestamp = new Date()) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;

      const timeStr = timestamp.toLocaleTimeString('zh-CN', {
        hour: '2-digit',
        minute: '2-digit'
      });

      // æ ¹æ®æ¶ˆæ¯ç±»å‹å†³å®šæ˜¯å¦æ¸²æŸ“markdown
      let renderedContent;
      if (type === 'ai') {
        renderedContent = renderMarkdown(content);
      } else {
        // ç”¨æˆ·æ¶ˆæ¯ä¿æŒåŸå§‹æ ¼å¼ä½†å¤„ç†æ¢è¡Œ
        renderedContent = content.replace(/\n/g, '<br>');
      }

      messageDiv.innerHTML = `
        <div class="message-content">
            <div class="message-text">${renderedContent}</div>
            <div class="message-time">${timeStr}</div>
        </div>
        `;

      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // å¦‚æœæœ‰ä»£ç å—ï¼Œè¿è¡Œä»£ç é«˜äº®
      if (typeof Prism !== 'undefined') {
        Prism.highlightAllUnder(messageDiv);
      }
      
      return messageDiv;
    }

    // æ›´æ–°æ¶ˆæ¯å†…å®¹
    function updateMessage(messageElement, content) {
      const textElement = messageElement.querySelector('.message-text');
      
      // åˆ¤æ–­æ˜¯å¦ä¸ºAIæ¶ˆæ¯ï¼ˆéœ€è¦markdownæ¸²æŸ“ï¼‰
      const isAiMessage = messageElement.classList.contains('ai');
      
      if (isAiMessage) {
        textElement.innerHTML = renderMarkdown(content);
        // é‡æ–°è¿è¡Œä»£ç é«˜äº®
        if (typeof Prism !== 'undefined') {
          Prism.highlightAllUnder(messageElement);
        }
      } else {
        textElement.innerHTML = content.replace(/\n/g, '<br>');
      }
    }

    // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
    function setLoading(loading, text = 'æ­£åœ¨æ€è€ƒ...') {
      isLoading = loading;
      loadingElement.classList.toggle('show', loading);
      loadingText.textContent = text;
      sendButton.disabled = loading;
      messageInput.disabled = loading;
    }

    // æ™®é€šæ¨¡å¼å‘é€æ¶ˆæ¯
    async function sendNormalMessage(message) {
      try {
        const response = await axios.post(`${API_BASE_URL}/chat`, {
          message: message,
          threadId: THREAD_ID
        });

        if (response.data.success) {
          const aiMessageElement = addMessage('ai', '');
          const textElement = aiMessageElement.querySelector('.message-text');
          await typewriterEffect(textElement, response.data.data.response, true);
        } else {
          addMessage('ai', 'æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶å‡ºç°äº†é”™è¯¯ã€‚');
        }
      }
      catch (error) {
        console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
        addMessage('ai', 'ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚');
      }
    }

    // æµå¼æ¨¡å¼å‘é€æ¶ˆæ¯
    async function sendStreamMessage(message) {
      try {
        const response = await fetch(`${API_BASE_URL}/chat/stream`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: message,
            threadId: THREAD_ID
          })
        });

        if (!response.ok) {
          throw new Error('Stream request failed');
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let aiResponse = '';
        let aiMessageElement = null;

        while (true) {
          const { done, value } = await reader.read();

          if (done) break;

          const chunk = decoder.decode(value);
          const lines = chunk.split('\n');

          for (const line of lines) {
            if (line.startsWith('data: ')) {
              try {
                const data = JSON.parse(line.slice(6));

                switch (data.type) {
                  case 'start':
                    setLoading(true, data.message);
                    break;

                  case 'thinking':
                    setLoading(true, data.message);
                    break;

                  case 'content':
                    if (isLoading) {
                      setLoading(false);
                      aiMessageElement = addMessage('ai', '');
                    }
                    
                    // ä½¿ç”¨æ‰“å­—æœºæ•ˆæœæ˜¾ç¤ºå®Œæ•´å“åº”
                    if (aiMessageElement && data.content) {
                      const textElement = aiMessageElement.querySelector('.message-text');
                      typewriterEffect(textElement, data.content.trim(), true);
                    }
                    break;

                  case 'end':
                    setLoading(false);
                    break;

                  case 'error':
                    setLoading(false);
                    addMessage('ai', `é”™è¯¯: ${data.message}`);
                    break;
                }
              } catch (e) {
                // å¿½ç•¥è§£æé”™è¯¯
              }
            }
          }
        }
      } catch (error) {
        setLoading(false);
        addMessage('ai', 'ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚')
      }
    }

    // å‘é€æ¶ˆæ¯
    async function handleSend() {
      const message = messageInput.value.trim()
      if (!message || isLoading) return

      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      addMessage('user', message);
      messageInput.value = ''
      setLoading(true)

      try {
        // é»˜è®¤ä½¿ç”¨æµå¼å“åº”æ¨¡å¼
        await sendStreamMessage(message)
      } finally {
        setLoading(false);
        messageInput.focus();
      }
    }

    // æ¸…ç©ºå¯¹è¯
    function clearMessages() {
      // åœæ­¢æ­£åœ¨è¿›è¡Œçš„æ‰“å­—æ•ˆæœ
      if (currentTypewriterTimeout) {
        clearTimeout(currentTypewriterTimeout);
        currentTypewriterTimeout = null;
      }
      messagesContainer.innerHTML = '';
      addMessage('ai', 'æ‚¨å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ');
    }

    // äº‹ä»¶ç›‘å¬
    sendButton.addEventListener('click', handleSend);
    clearButton.addEventListener('click', clearMessages);

    messageInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    })

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      checkConnection();
      clearMessages();
      messageInput.focus();


      // å®šæœŸæ£€æŸ¥è¿æ¥çŠ¶æ€
      setInterval(checkConnection, 30000);
    })
  </script>
</body>

</html>